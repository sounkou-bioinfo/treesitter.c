---
output: github_document
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  out.width = "100%"
)
```

# treesitter.c

C grammar for the R treesitter package.

## Installation

```{r eval=FALSE}
# Install treesitter.c from GitHub
remotes::install_git("https://github.com/sounkou-bioinfo/treesitter.c")
```

## Usage
```{r eval=TRUE}
library(treesitter)
library(treesitter.c)

c_language <- language()
parser <- parser(c_language)

code <- "
struct Point {
  int x[MAX_SIZE];
  int y;
};
"

tree <- parser_parse(parser, code)
tree
```

## Parsing R headers (example)

```{r eval=TRUE}
# Parse R headers installed on this machine
hdr_df <- parse_r_include_headers(dir = R.home("include"), preprocess = FALSE)
# Show the first few functions discovered
hdr_df[
  grepl("Rf", x = hdr_df$name),] |>
      head(10)

# If you have a C compiler available and want to preprocess macros
# (recommended for headers that use macros for types), enable preprocess = TRUE.
# Prefer to use the helper `r_cc()` defined in the package which consults R's
# configuration and environment. This ensures consistent behavior across
# platforms and environments.
cc <- treesitter.c::r_cc()
# When preprocessing system headers, pass the include path via `include_dirs` so
# the preprocessor can find nested headers and macros correctly.
hdr_df_pp <- parse_r_include_headers(dir = R.home("include"), preprocess = TRUE, include_dirs = R.home("include"))
hdr_df_pp[
  grepl("Rf", x = hdr_df_pp$name),] |>
      head(10)

```

## Details

**ABI Version 14**, compatible with treesitter package version 0.3.0. The C grammar source used for bootstrapping was downloaded from https://github.com/tree-sitter/tree-sitter-c. The pre-generated `parser.c` from upstream is ~3.7 MB and contains pragma directives that trigger CRAN check warnings.

During bootstrap (`bootstrap.R`), all `#pragma` directives are automatically removed from `parser.c` to ensure CRAN compliance. This includes pragmas for diagnostic control and optimization settings that are not portable across compilers.

## License

GPL-3
